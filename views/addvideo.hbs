<script>
    async function getSubjectlist() {
        console.log("get subject list");
        const universitySelect = document.getElementById('university-select');
        const courseSelect = document.getElementById('course-select');
        const semesterSelect = document.getElementById('semester-select');
        const subjectSelect = document.getElementById('subject-select');
        let selectedUniversity = universitySelect.value;
        let selectedCourse = courseSelect.value;
        let selectedSemester = semesterSelect.value;
        const response = await fetch(`/subjectlist?university=${selectedUniversity}&semester=${selectedSemester}&course=${selectedCourse}`);
        const subjects = await response.json();
        subjectSelect.innerHTML = '';
        const nullOption = document.createElement('option');
        nullOption.value = 'null';
        nullOption.textContent = 'Select Subject';
        subjectSelect.appendChild(nullOption);
        subjects.forEach((subject) => {
            const option = document.createElement('option');
            option.value = subject.fsubjectname;
            option.textContent = subject.subjectname;
            subjectSelect.appendChild(option);
        });
    }

    async function getModulelist() {
        console.log("get module list");
        const universitySelect = document.getElementById('university-select');
        const courseSelect = document.getElementById('course-select');
        const semesterSelect = document.getElementById('semester-select');
        const subjectSelect = document.getElementById('subject-select');
        const moduleSelect = document.getElementById('module-select');
        let selectedUniversity = universitySelect.value;
        let selectedCourse = courseSelect.value;
        let selectedSemester = semesterSelect.value;
        let selectedSubject = subjectSelect.value;
        const response = await fetch(`/modulelist?university=${selectedUniversity}&semester=${selectedSemester}&course=${selectedCourse}&subject=${selectedSubject}`);
        const modules = await response.json();
        moduleSelect.innerHTML = '';
        const nullOption = document.createElement('option');
        nullOption.value = 'null';
        nullOption.textContent = 'Select Module';
        moduleSelect.appendChild(nullOption);
        const allOption = document.createElement('option');
        allOption.value = 'all-module';
        allOption.textContent = 'All Module';
        moduleSelect.appendChild(allOption);
        modules.forEach((module) => {
            const option = document.createElement('option');
            option.value = module.fmodulename;
            option.textContent = module.modulename;
            moduleSelect.appendChild(option);
        });
    }
</script>


<div id="video-form" class="md:px-48 pt-8">
    <form action="/video" method="post" class="grid grid-cols-3 gap-4">
        <h2 class="text-xl font-semibold mb-2 block md:col-span-3">Add Video</h2>

        <div class="mb-4 block md:col-span-1">
            <label for="university-select" class="block">University:</label>
            <select name="universityname" id="university-select" onchange="getSubjectlist()"
                class="border border-gray-400 px-4 py-2 rounded w-64">
                {{!-- <option value="null">Select University</option> --}}

                {{#each university}}
                <option value="{{this.funiname}}">{{this.uniname}}</option>
                {{/each}}
            </select>
        </div>
        <div class="mb-4 block md:col-span-1">
            <label for="course-select" class="block">Course:</label>
            <select name="coursename" id="course-select" onchange="getSubjectlist()"
                class="border border-gray-400 px-4 py-2 rounded w-64">
                <option value="null">Select Course</option>

                {{#each course}}
                <option value="{{this.fcoursename}}">{{this.coursename}}</option>
                {{/each}}
            </select>
        </div>
        <div class="mb-4 block md:col-span-1">
            <label for="semester-select" class="block">Semester:</label>
            <select name="semestername" id="semester-select" onchange="getSubjectlist()"
                class="border border-gray-400 px-4 py-2 rounded w-64">
                <option value="null">Select Semester</option>
                {{#each semester}}
                <option value="{{this.fsemestername}}">{{this.semestername}}</option>
                {{/each}}
            </select>
        </div>

        <div class="mb-4 block md:col-span-1">
            <label for="subject-select" class="block">Subject:</label>
            <select name="subjectname" id="subject-select" onchange="getModulelist()"
                class="border border-gray-400 px-4 py-2 rounded w-64">
                <option value="null">Select Subject</option>

                {{!-- {{#each subject}}
                <option value="{{this.fsubjectname}}">{{this.subjectname}}</option>
                {{/each}} --}}
            </select>
        </div>

        <div class="mb-4 block md:col-span-1">
            <label for="module-select" class="block">Module:</label>
            <select name="modulename" id="module-select" class="border border-gray-400 px-4 py-2 rounded w-64">
                <option value="null">Select Module</option>

                {{!-- {{#each module}}
                <option value="{{this.fmodulename}}">{{this.modulename}}</option>
                {{/each}} --}}
            </select>
        </div>

        <div class="mb-4 block md:col-span-2">
            <label for="video-name" class="block">Video Name:</label>
            <input type="text" name="videoname" id="video-name"
                class="block border border-gray-400 px-4 py-2 rounded w-full">
        </div>

        <div class="mb-4 block md:col-span-1">
            <label for="video-link" class="block">Video Link:</label>
            <input type="text" name="videolink" id="video-link"
                class="block border border-gray-400 px-4 py-2 rounded w-full">
        </div>

        <div class="block md:col-span-3">
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Add</button>
        </div>
    </form>

    <table class="min-w-full divide-y divide-gray-200 mt-12">
        <thead class="bg-gray-50">
            <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    No
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Video</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    University</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Course</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Semester</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Subject</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Module</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {{#each video}}
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">{{@index}}</td>
                <td class="px-6 py-4 whitespace-nowrap"><a href="{{this.videolink}}" target="_blank"
                        class="text-blue-500 underline">{{this.videoname}}</a></td>
                <td class="px-6 py-4 whitespace-nowrap">{{this.universityname}}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{this.coursename}}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{this.semestername}}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{this.subjectname}}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{this.modulename}}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <a href="/subject/delete/{{this._id}}" class="text-red-500 hover:text-red-700">Delete</a>
                </td>
            </tr>
            {{/each}}
            <!-- Add more table rows as needed -->
        </tbody>
    </table>
</div>